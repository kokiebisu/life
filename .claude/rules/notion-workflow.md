# Notion ワークフロー

## Notion MCP サーバー名

- `ReadMcpResourceTool` のサーバー名は **`claude.ai Notion`**（スペース・ドット入り）
- ツール名の `mcp__claude_ai_Notion__*` と混同しないこと

## 基本方針

- **全イベント・タスクを Notion データベースで管理**
- Notion Calendar で閲覧（Google Calendar と双方向同期）
- タスクには Feedback 欄あり → 翌日 API で取得して次の日のスケジュールに反映

## 操作ルール

- **時間変更時: 前後の予定も連鎖チェックし、かぶりがあれば全部まとめて調整する**
- **タスク追加時: 必ず時間（--start/--end）を入れる**（--allday は使わない）
- **説明・詳細はページ本文に書く**（後述「ページ本文ルール」参照）
- **完了済タスクの追加時**（「〜してた」「〜やった」等）→ ステータスを「完了」にセットする
- **同名エントリがある場合は確認する**: 同名のエントリが既にある場合、既存エントリを勝手に移動・変更せず「同じ名前のエントリがあるけど、新しく追加していい？」とユーザーに確認する
- **重複エントリ防止**: 登録前に `notion-list.ts --date YYYY-MM-DD --json` で既存エントリを取得。同名・同内容があれば `notion-update-page` で更新、ない場合のみ新規登録

## DB の使い分け

- **todo（やること）**: 一回限りのタスク・作業（申請、書類手続き、メール整理、調べものなど）
- **events（イベント）**: 一回限りの予定で、人と会う・場所に行くもの（飲み会、面談、見学など）
- **routine（習慣）**: 繰り返しやる活動。毎日・毎週やるもの（Devotion、ギター練習、sumitsugi開発など）
- 迷ったら:
  - 「人と会う or 外出する？」→ Yes なら events
  - 「今後も繰り返すか？」→ Yes なら routine
  - どちらでもない作業・タスク → todo

## Notion DB 体制

### Schedule DBs

| DB | 環境変数 | プロパティ | 用途 |
|----|---------|-----------|------|
| 習慣 | `NOTION_TASKS_DB` | Name / 日付 | 繰り返しルーティン |
| イベント | `NOTION_EVENTS_DB` | 名前 / 日付 | 一回限りの予定 |
| ギター | `NOTION_GUITAR_DB` | 名前 / 日付 | ギター練習・レッスン |
| 食事 | `NOTION_MEALS_DB` | 名前 / 日付 | 食事メニュー（調理・食べるもの） |
| 買い出し | `NOTION_GROCERIES_DB` | 件名 / 日付 | 買い出し・買い物 |

### Other DBs

- `NOTION_ARTICLES_DB` — 記事（タイトル / ソース / URL / Aspect / Status）
- `NOTION_INVESTMENT_DB` — 投資（Investment / Buy Date / Status / Type / Notes）

## ページ本文ルール（Description プロパティ廃止）

**DB の Description / 説明プロパティは使わない。** 内容はすべてページ本文に書く。

- `--desc` オプションは廃止済み。`notion-add.ts` に渡しても無視される
- 説明・詳細・レシピ・レッスン内容などは、ページ作成後に `notion-update-page` の `replace_content` でページ本文に書き込む
- **手順:** `notion-add.ts` → ページ ID 取得 → `notion-update-page`（`replace_content`）で本文を書く

## Notion 操作の安全ルール

### Notion ページ ID の取り違え防止

複数エントリを一括更新するとき、**更新前に ID→タイトルの対応表を書き出して確認する。** UUID の目視コピーは取り違えやすいため、JSON 出力から ID を拾うときは必ずタイトルとセットで扱う。

### スクリプト実行前に構文を確認する

- `notion-add.ts` 等を呼ぶ前に、必ず正しい引数形式を使う（`--title` 必須）
- 構文が不明なら `--help` や使い方コメントを確認してから実行する
- **間違った構文で試行錯誤しない** — 誤実行が副作用を起こすリスクがある

### 実行後に必ず結果を検証する

- `notion-add.ts` でエントリを追加した後、`notion-list.ts --date` で**追加した対象だけでなく、同じ日の全エントリ**を確認する
- 既存エントリが意図せず消えていないか確認する
- 異常があれば即座にユーザーに報告し、Notion MCP で復旧する

### 類似名エントリに注意する

- 「Aパーティ」と「Aパーティ買い出し」のように名前が似たエントリを扱うとき、重複検出の誤判定に注意する
- 重複検出でスキップされた場合、本当に同一エントリか（名前・時間が完全一致か）を確認する
- 誤判定でブロックされたら、Notion MCP（`notion-create-pages`）で直接登録する

## スクリプト一覧

共通ライブラリ: `scripts/lib/notion.ts`

CLI コマンドの使い方は `/calendar` コマンドを参照。
