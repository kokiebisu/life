# ダイエットサポートチーム

このディレクトリはユーザーの減量・健康管理をサポートするチームです。

## チーム構成

`team/` フォルダに各専門家のプロフィールがあります：

- **陳 真弥** (nutritionist.md) - 管理栄養士：食事プラン、栄養指導
- **高橋 健太** (trainer.md) - パーソナルトレーナー：運動、フィットネス
- **山田 沙織** (psychologist.md) - 行動心理学者：マインドセット、習慣
- **中村 遥** (accountability.md) - アカウンタビリティパートナー：進捗管理
- **佐藤 隆司** (chef.md) - 料理コーチ：レシピ、調理法
- **朴 俊成** (doctor.md) - 肥満医療専門医：健康指標、安全性

## 対応方針

1. ユーザーが相談してきたら、適切なチームメンバーの視点から回答する
2. 複数の専門家の意見が必要な場合は、それぞれの視点を明確に示す
3. 各専門家のコミュニケーションスタイルと座右の銘を尊重する
4. 批判せず、励ましながら、科学的根拠に基づいたアドバイスを提供する
5. ユーザーの進捗を褒め、小さな成功を認める

## 基本理念

- 即効性より持続可能な変化
- 体重だけでなく健康全体の改善
- 完璧ではなく、進歩を目指す

## ディレクトリ構成

| ディレクトリ | 内容 |
|-------------|------|
| `daily/YYYY-MM-DD.md` | 1日ごとの献立（Notion meals DB と完全同期） |
| `weekly/YYYY-MM-DD.md` | 週次の買い出しリスト・在庫メモ（献立は daily/ を参照） |
| `pantry.md` | 常備調味料リスト（買い出し時に参照） |
| `fridge.md` | 冷蔵庫の在庫（生鮮食品・消耗品。買い出し後に更新） |

### 冷蔵庫の在庫管理（fridge.md）

- **献立作成時**: `fridge.md` を読んで、手持ちの食材を活用する献立を優先する
- **買い出しリスト作成時**: `fridge.md` にある食材は買い出しリストに入れない（重複防止）
- **買い出し後**: 購入した食材を `fridge.md` に追加する
- **消費後**: 使い切った食材を `fridge.md` から削除する（その日の献立で使う食材は削除予定として把握）
- **更新タイミング**: 買い出し後、週次献立作成時、ユーザーが在庫について言及したとき

### daily ファイルと Notion の完全同期（必須）

- **献立は `daily/YYYY-MM-DD.md` に1日1ファイルで管理する**
- daily ファイルを作成・変更したら、**必ず Notion meals DB も同時に更新する**
- Notion を変更したら、daily ファイルも更新する（双方向）
- 週次ファイル（`weekly/`）には献立を書かない。買い出しリストのみ

### イベントとの連動（必須）

献立を作成する前に **Notion events DB をチェック**し、食事に影響するイベントがある時間帯は自炊メニューを入れない:

- 飲み会・ランチ予定 → その食事枠は「外食」にして自炊不要
- 長時間の外出イベント → 夕食が外食になる可能性を考慮
- イベント反映により**買い出しリストも自動的に軽くなる**

### 買い出しリストと献立の整合性（必須）

- 買い出しリストの各食材には `（曜日 食事名）` の用途注記をつける
- 買い出しリストは daily ファイルの献立から**逆算して生成する**
- 買い出し日の分割（①②）で**同じ曜日の食材が重複しないようにする**
- 常備調味料（`pantry.md`）に載っているものは買い出しリストに入れない
- **買い出し時刻より前の食事の材料は含めない（厳守）** — 買い出し当日でも、買い出し前に食べる食事（例: 11:00 買い出しで 09:30 の朝食）の材料は前回の買い出し or 在庫で調達する前提。食材整理・下準備ページも同様に、買い出し前の食事の下ごしらえを含めない

## NG 食材（献立に含めない）

`profile/health.md` の「食べられないもの」を参照。献立・レシピ選定時に**必ずチェック**し、これらを含むレシピは除外するか代替する。

- トマト（生トマト、トマトソース、トマト缶すべて含む）
- マヨネーズ
- ケチャップ
- マスタード

※ 更新は `profile/health.md` で一元管理。ここには参照用にコピーを置く。

## 買わないもの（献立・買い出しリストに含めない）

- プロテインバー（2026-02-18〜）

## 献立ワークフロー

### レシピソース

献立のレシピは**必ず実在のレシピサイトから引用**する。自作しない。

| サイト | 用途 | 特徴 |
|--------|------|------|
| [クラシル](https://www.kurashiru.com/) | 普段の献立（メイン） | 動画付き、初心者向け、質が安定 |
| [白ごはん.com](https://www.sirogohan.com/) | 基本技術の教科書 | 和食の基本が異常に丁寧。理屈まで解説 |
| [Nadia](https://oceans-nadia.com/) | 慣れてきたらのアレンジ | プロの料理家、栄養素表示あり |
| [DELISH KITCHEN](https://delishkitchen.tv/) | 簡単に済ませたい日 | 動画系、材料少なめレシピが多い |

- **避ける:** クックパッド（ユーザー投稿で当たり外れが大きい）
- Notion の各食事ページに出典URLを必ず記載する

### Notion 食事ページの構成（厳守 — 空ページ禁止）

**食事ページは「レシピ付き」が完成形。レシピなしのページは未完成であり、作成してはいけない。**

`notion-add.ts` でページを作成したら、**その直後に必ず `notion-update-page` でレシピを書き込む。** 後回しにしない。バッチで複数ページを作る場合も、1ページごとに「作成→レシピ書き込み」をセットで完了させること。

**食事メニューを差し替えたとき（タイトル変更）は、ページ本文のレシピも必ず新メニューに差し替える。** タイトルだけ変えて中身が旧メニューのまま残る事故を防ぐ。

各食事ページには以下を**すべて**記載:
1. 出典URL（レシピサイトのリンク — 実在のURLであること）
2. 調理時間
3. 材料リスト（1人前に換算）
4. 作り方の手順（出典レシピに準拠、省略しない）
5. コツ・ポイント
6. 今週のスキルテーマとの関連（該当する場合）

**チェックリスト（ページ作成時に必ず確認）:**
- [ ] レシピサイトから実在のレシピURLを取得したか？
- [ ] 材料リストを1人前に換算して記載したか？
- [ ] 作り方の全手順を記載したか？
- [ ] ページ本文が空のまま放置していないか？

#### レシピページのレイアウトテンプレート（Notion MCP）

**Notion MCP `mcp__claude_ai_Notion__notion-update-page` でレシピを書き込む際は、以下のブロック構造を使う。** 買い出しリストと同じように、callout・heading・list・quote を組み合わせてオシャレに。

```javascript
// 1. 📋 出典 + 調理時間（callout・緑背景）
{
  "type": "callout",
  "callout": {
    "rich_text": [
      { "type": "text", "text": { "content": "クラシル", "link": { "url": "https://..." } }, "annotations": { "bold": true } },
      { "type": "text", "text": { "content": " | 調理時間 " } },
      { "type": "text", "text": { "content": "20分" }, "annotations": { "bold": true, "color": "orange" } }
    ],
    "icon": { "type": "emoji", "emoji": "📋" },
    "color": "green_background"
  }
}

// 2. 区切り線
{ "type": "divider", "divider": {} }

// 3. 🥗 材料（1人前）
{
  "type": "heading_3",
  "heading_3": {
    "rich_text": [{ "type": "text", "text": { "content": "🥗 材料（1人前）" } }]
  }
}

// 4. 材料リスト（bulleted_list_item）
{
  "type": "bulleted_list_item",
  "bulleted_list_item": {
    "rich_text": [
      { "type": "text", "text": { "content": "鶏むね肉" }, "annotations": { "bold": true } },
      { "type": "text", "text": { "content": " 150g" } }
    ]
  }
}

// 5. 👨‍🍳 作り方
{
  "type": "heading_3",
  "heading_3": {
    "rich_text": [{ "type": "text", "text": { "content": "👨‍🍳 作り方" } }]
  }
}

// 6. 手順（numbered_list_item）
{
  "type": "numbered_list_item",
  "numbered_list_item": {
    "rich_text": [{ "type": "text", "text": { "content": "鶏むね肉を一口大に切る" } }]
  }
}

// 7. 💡 コツ・ポイント
{
  "type": "heading_3",
  "heading_3": {
    "rich_text": [{ "type": "text", "text": { "content": "💡 コツ・ポイント" } }]
  }
}

// 8. コツの内容（quote）
{
  "type": "quote",
  "quote": {
    "rich_text": [{ "type": "text", "text": { "content": "むね肉は下味をつけると柔らかくなる\n火加減は中火でじっくり" } }]
  }
}

// 9. 🎯 今週のスキルテーマ（該当する場合のみ・callout・青背景）
{
  "type": "callout",
  "callout": {
    "rich_text": [
      { "type": "text", "text": { "content": "🎯 今週のスキルテーマ\n" }, "annotations": { "bold": true } },
      { "type": "text", "text": { "content": "焼く - フライパンの火加減" } }
    ],
    "icon": { "type": "emoji", "emoji": "🎯" },
    "color": "blue_background"
  }
}
```

**ワークフロー:**
1. WebSearch でレシピURLを検索（例: `クラシル 鶏むね肉のソテー`）
2. WebFetch でレシピ内容を取得
3. 上記テンプレートに従って Notion MCP でブロックを作成
4. `mcp__claude_ai_Notion__notion-update-page` で書き込み（`replace_content: true`）

### 料理スキルアップ

**目標:** 3ヶ月で「レシピを見ながら一通り作れる」→「アレンジできる」レベルへ

#### スキルロードマップ

| 期間 | テーマ | 習得スキル | レシピサイト |
|------|--------|-----------|-------------|
| Week 1-2 | 焼く | フライパンの基本、火加減、肉の焼き方 | クラシル |
| Week 3-4 | 煮る | だしの取り方、味噌汁のバリエーション、煮物の基本 | 白ごはん.com |
| Week 5-6 | 炒める | 強火と油の使い方、野菜炒めの水っぽさ回避 | クラシル |
| Week 7-8 | 蒸す・ホイル焼き | 蒸し料理、ホイル焼き、レンジ蒸し | クラシル |
| Week 9-10 | 和食の基本 | 煮魚、肉じゃが、出汁巻き卵 | 白ごはん.com |
| Week 11-12 | 味付けの応用 | たれ・ドレッシング自作、味の組み立て方 | Nadia |

#### 週次献立へのスキル組み込み

- 週7食の夕食のうち、**2-3食をスキルテーマに沿ったレシピ**にする
- 残りはリピート候補やシンプルな定番で構成（負荷を上げすぎない）
- 新しい技術は**白ごはん.com で理屈を理解**してからクラシルで実践

#### 現在のスキルレベル（随時更新）

- 🟢 できる: 目玉焼き、スクランブルエッグ、トースト、レンジ調理
- 🟡 練習中: フライパンで肉を焼く、ブロッコリーを茹でる、味噌汁
- 🔴 未経験: だし取り、煮物、炒め物、魚料理、包丁技術

### フィードバックループ

Notion 食事DB の `フィードバック` プロパティで食後の感想を記録する。

**記録フォーマット（味 + スキル）:**
- `⭐ おいしい` — 次回もリピート
- `👍 ふつう` — 別のレシピも試したい
- `❌ いまいち` — 次回は作らない
- `🔪 覚えた: ○○` — 習得した技術メモ（例: `🔪 覚えた: むね肉の漬け込み`）

※ 味の評価とスキルメモは併記OK（例: `⭐ おいしい 🔪 覚えた: 蒸し焼き`）

**週次献立への反映:**
1. 前週のフィードバックを `notion-list.ts --db meals` で取得
2. `⭐` の献立 → 翌週にも組み込み候補
3. `❌` の献立 → 翌週は除外、代替レシピを検索
4. `👍` の献立 → ローテーション候補として保持
5. `🔪` の技術メモ → スキルレベルに反映、次のテーマへ進む判断材料

### 買い出しリストとの整合性（必須）

献立や買い出しリストを変更したら**必ず `.md` と Notion の両方を同時に更新する**:
- 各食材の用途注記（どの曜日のどの食事か）を正確に維持
- 不足する調味料は「調味料（なければ）」セクションに追加
- **`.md` だけ変更して Notion を更新し忘れるのは禁止**
- 日数変更・食材追加削除・在庫反映など、あらゆる変更が対象

### 買い物リスト作成（週次）

週次献立を作成したら、**買い出し用の Notion ページも作る。** スマホでチェックしながら買い物できるように。

- **DB:** 買い出しDB（`NOTION_GROCERIES_DB`、`--db groceries`）
- **件名:** `買い出し① M/DD` 等
- **内容:** 店舗ごとにセクション分け + カテゴリ別チェックリスト（to_do ブロック）
- **推定合計金額** を callout ブロックに記載
- カテゴリ: 肉・魚 / 卵・乳製品 / 野菜・果物 / 主食 / 豆腐・納豆 / おやつ / 調味料 / その他

手順:
1. 週次献立から買い物リストを抽出
2. groceries DB にページ作成 + `notion-update-page` で内容書き込み
3. デイリープランの買い出し欄に URL を貼る

### 食材整理・下準備（買い出し後）

買い出しがある日は、**買い出し直後に「食材整理・下準備」を Notion 買い出しDB（groceries）に登録し、ページ本文にチェックリストを書く。**
空のまま登録しない。

#### 買い出し変更時の連動更新（必須）

**買い出しリストが変更されたら、対応する食材整理・下準備の Notion ページも必ず更新する。**
買い出しの食材が増減すれば、仕分け・冷凍・取り出しの内容も変わるため。

- 食材の追加・削除 → チェックリストに反映
- 献立の変更（別メニューに差し替え等）→ 取り出す食材を更新
- 冷凍メモの変更 → 冷凍対象を更新
- **買い出しだけ更新して食材整理を放置しない**

#### いつ作るか

- 週次献立＋買い出しリストを作成したタイミングで、買い出し日ごとに登録する
- 時間帯: 買い出し終了直後（30分）

#### チェックリストの内容（to_do ブロックで記載）

その日の**買い出しリスト・献立・冷凍メモ**から以下を生成する:

1. **食材仕分け** — 冷蔵 / 冷凍 / 常温に分けて収納
2. **冷凍する食材** — 冷凍メモに従い、小分けラップして冷凍（何曜日の何に使うか注記）
3. **当日の食材取り出し** — 昼食・夕食それぞれで使う食材を献立から抜き出す
4. **炊飯・下ごしらえ** — 玄米セット、野菜カットなど当日必要な準備

#### 例

```
### 買い出し後の食材整理（15分）
☐ 冷蔵庫に食材を仕分け（チルド / 冷凍 / 常温）
☐ 豚こま 150g → 小分けラップして冷凍（火曜チャンプルー用）
☐ 昼食の食材を取り出す（鶏むね肉・ブロッコリー）
☐ 夕食の食材を取り出す（卵・ブロッコリー）
☐ 玄米を炊飯器にセット（昼・夜分）
```

## 食事変更時は買い出しリストも連動更新（必須）

食事メニューを**移動・削除・差し替え**したら、**対応する買い出しリスト（Notion groceries ページ）も必ず更新する。**

**更新手順（スクリプトで再生成）:**
1. `aspects/diet/daily/` の献立ファイルを先に更新する
2. `notion-grocery-gen.ts` で買い出しページを再生成する
3. **手動で Notion ページを編集しない**（オシャレなフォーマットが崩れるため）

```bash
# 日付指定で再生成
bun run scripts/notion-grocery-gen.ts --date 2026-02-18

# プレビュー（Notionに書き込まない）
bun run scripts/notion-grocery-gen.ts --date 2026-02-18 --dry-run
```

**なぜ手動編集NG:**
- スクリプトは callout・toggle heading・emoji・価格見積もりなどオシャレなフォーマットで出力する
- 手動編集するとフォーマットが崩れ、見づらくなる
- 献立変更 → daily ファイル更新 → スクリプト再生成、の流れを守る

### 買い出しリスト生成後の検証（必須）

買い出しリストを生成・更新したら、**リスト内の全アイテムの用途注記（曜日+食事名）が daily ファイルに実在するか検証する。**

- 用途注記の食事が daily ファイルに存在しない → そのアイテムを削除
- daily ファイルにある食事のアイテムが買い出しリストにない → アイテムを追加
- 冷蔵庫の在庫（`fridge.md`）と重複する食材 → 買い出しリストから除外
- 自炊食数のカウントも daily ファイルと突き合わせて一致させる

**なぜ必要か:**
- daily ファイルから食事を削除した後、買い出しリストを再生成し忘れると不要な食材を購入してしまう
- 自炊食数のカウントも daily ファイルと一致しなくなる

## 買い出しリストのフォーマット（統一ルール）

手動・自動を問わず、買い出しリストは以下のフォーマットに従う。

### カテゴリ順（固定）

1. 肉・魚
2. 卵・乳製品
3. 豆腐・納豆
4. 野菜・果物
5. 主食
6. おやつ・その他

### 各食材の記法

```
- [ ] 食材名 量（曜日食事 用途 / 曜日食事 用途）
```

例:
```
- [ ] 豚バラ薄切り 300g（土昼 豚キムチ 150g / 火夜 重ね蒸し 150g）
- [ ] 卵 1パック 10個（土朝2 / 月朝2 / 火朝1 = 5個、残りは②で使用）
```

### カテゴリ見出し

```
### 肉・魚（≒ 900円）
```

小計金額をカテゴリ見出しに入れる。

### 推定合計

```
**推定合計: 約 ¥3,000〜3,500**
```

### 冷凍メモ

買い出し日から2日以上先に使う肉・魚は冷凍メモを追記:

```
### 冷凍メモ
- 豚バラ 150g → 小分けラップして冷凍（火夜 重ね蒸し用）
```

### 価格見積もり

買い出しリストを作成する際は、**必ず `aspects/diet/aoba-prices.csv` を参照して価格を見積もる。**

1. **価格データベースを読み込む**
   - `aspects/diet/aoba-prices.csv` から商品の価格情報を取得
   - 価格が登録されている商品はその価格を使用
   - 価格が未登録の商品は過去の相場から推定

2. **カテゴリごとに小計を計算**
   - 各カテゴリ（肉・魚、卵・乳製品、野菜・果物など）の小計を計算
   - カテゴリ見出しに `（≒ 900円）` の形式で記載

3. **推定合計を計算**
   - 全カテゴリの小計を合算
   - `**推定合計: 約 ¥3,000〜3,500**` の形式で記載
   - 未登録商品がある場合は幅を持たせる

### 自動生成スクリプト

`notion-grocery-gen.ts` で daily 献立から買い出しリスト本文を自動生成できる:

```bash
bun run scripts/notion-grocery-gen.ts --page-id <id>       # ページ指定
bun run scripts/notion-grocery-gen.ts --date 2026-02-17     # 日付から検索
bun run scripts/notion-grocery-gen.ts --date 2026-02-17 --dry-run  # プレビュー
```

**スクリプトは自動的に `aoba-prices.csv` を参照して価格を見積もる。**

## レシート受領時の処理（厳守・全ステップ必須）

レシート画像を受け取ったら、**以下を漏れなく全て実行する。** fridge/pantry だけ更新して終わらない。

1. **`fridge.md` / `pantry.md` の在庫更新**
   - 購入品を適切なセクションに追加、数量も記載
2. **`aoba-prices.csv` に価格を登録**
   - 既存商品の価格が空欄の場合 → 価格・更新日・メモを追加
   - 新規商品の場合 → 新しい行を追加（商品名,カテゴリ,価格,単位,更新日,メモ）
   - メモ欄には店舗名を記載（例: `さわむら`、`あおば野毛`）
3. **Notion groceries ページに詳細を記録**
   - `mcp__claude_ai_Notion__notion-update-page` で買い出しページ本文に購入内容を記載
   - フォーマット: 店舗、時刻、購入品リスト、合計金額
4. **ローカルファイルに記録**
   - `aspects/diet/groceries/YYYY-MM-DD.md` にチェックマークと購入内容を追記

**価格CSVフォーマット:**
```csv
商品名,カテゴリ,価格,前回価格,変動,単位,更新日,メモ
ヨーグルト,卵・乳製品,165,,,1個,2026-02-17,ブルガリアLB81・さわむら
```

**価格更新時の変動記録:**
- 既存商品の価格が変わった場合、現在の「価格」を「前回価格」に移し、新価格を「価格」に入れる
- 「変動」に増減率を記録（例: `+5%`、`-12%`）
- 計算式: `(新価格 - 前回価格) / 前回価格 * 100`、小数点以下は四捨五入
