# Event - イベント登録

ユーザーが口頭でイベントを伝えたら、適切な日時を判断してNotionカレンダーに登録する。

## Steps

1. **現在のカレンダーを確認する**
   ```bash
   bun run scripts/notion-list.ts --days 7 --json
   ```

2. **ユーザーの入力を分析する**
   - イベント名・内容
   - 日時のヒント（「来週」「金曜に」「明後日」など）
   - 所要時間の推定
   - 依存関係（「ジムの後」「開発の合間」など）

3. **日時を決定する** — 以下を考慮:
   - **既存の予定との衝突を避ける**（カレンダーの空き時間に入れる）
   - **理想のルーティン** — `aspects/routine/CLAUDE.md` を参照して空き時間を判断する
   - **イベントはルーティンより常に優先。** ルーティンと重なる場合でも、イベントをそのまま登録する。重なったルーティン項目は別の空き時間にずらすか、その日はスキップとして報告する。
   - **ユーザーが明示した日時があればそれを最優先**する

4. **提案してから登録する**
   - 決定した日時とイベント内容をユーザーに提示する
   - 確認を得てから登録する（間違った時間に入れると困るため）

5. **Notionに登録する**
   ```bash
   bun run scripts/notion-add.ts --title "イベント名" --date YYYY-MM-DD --start HH:MM --end HH:MM
   bun run scripts/notion-add.ts --title "イベント名" --date YYYY-MM-DD --allday  # 終日イベント
   ```
   説明はページ作成後に `notion-update-page` の `replace_content` で本文に書く。

6. **登録結果を報告する**

## 注意

- **既存イベントは絶対に上書き・削除しない。** 新規追加のみ行う。
- 既存イベントと重複するタスクは登録しない（空き時間にのみ追加する）。
- 日時が曖昧な場合は必ず確認する。勝手に決めすぎない。
- 複数日にまたがるイベントは日ごとに分けて登録する。
- ルーティンとの衝突がある場合は、登録結果の報告時に「○○の時間と重なるため、その日はスキップ or 別時間にずらすのがおすすめ」と一言添える。
- `$ARGUMENTS` にイベント内容が入る。

## イベント候補日の提案時は天気を考慮する

ユーザーが「いつがいい？」「候補日は？」と聞いてきたとき、または日程を選べるイベントを登録するとき:

1. `bun run scripts/weather.ts --date YYYY-MM-DD --date YYYY-MM-DD ... --json` で候補日の天気を取得
2. 外出おすすめ度（`score`）を判断材料に加える
3. 天気が悪い日（score 1-2）は「雨の可能性あり」等を添えて候補から下げる
4. 複数候補がある場合、天気が良い日を優先的に提案する

**対象:** 外出を伴うイベント（飲み会、遊び、買い出しなど）。在宅作業系のタスクには天気チェック不要。

**注意:** Open-Meteo API は最大16日先まで。それ以降は天気情報なしで提案する。

## 移動時間の自動管理

外出を伴うイベント（`@ 場所名` があるもの）を登録するとき、**移動時間を含めたブロックで登録する。**

**ワークフロー:**

1. イベントに場所がある（タイトルに `@ location`）場合、移動元を確認する
   - 前のイベントの `場所` プロパティがあればそこから出発
   - なければユーザーの自宅（**MEMORY.md の住所をそのまま `--from` に渡す。駅名や略称ではなく、必ず正式な住所を使うこと**）
2. `travel-time.ts` で移動時間を見積もる（`--from` には MEMORY.md の正式住所を使う）
   ```bash
   bun run scripts/travel-time.ts --from "<MEMORY.mdの住所>" --to "藤沢善行" --json
   ```
3. 移動時間込みの `--start`/`--end` と実際の `--actual-start`/`--actual-end` で登録
   ```bash
   bun run scripts/notion-add.ts \
     --title "バレーボール @ 藤沢善行" \
     --date 2026-02-17 \
     --start 18:00 --end 21:30 \
     --actual-start 18:30 --actual-end 21:00 \
     --location "神奈川県藤沢市善行7-1-2" \
     --db events
   ```
4. 場所が不明確な場合はユーザーに確認する

**プロパティの使い分け:**
- `日付`（既存）= 移動込みブロック（例: 18:00-21:30）
- `開始時間`（rich_text）= 実際のイベント開始時刻（例: "18:30"）
- `終了時間`（rich_text）= 実際のイベント終了時刻（例: "21:00"）
- `場所`（rich_text）= API 用の正確な住所（例: "神奈川県藤沢市善行7-1-2"）
- タイトルの `@ 略称` = 表示用（例: `バレーボール @ 藤沢善行`）
- `場所` が空 = 自宅（Claude が MEMORY.md の住所を使用）

**帰宅の移動時間:**
- イベント終了後の帰宅時間も `--end` に含める（例: イベント 21:00 終了 + 帰宅 30分 = `--end 21:30`）
- `--actual-end` にはイベント自体の終了時刻を入れる
